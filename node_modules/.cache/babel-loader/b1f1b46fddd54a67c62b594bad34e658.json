{"ast":null,"code":"import _slicedToArray from \"C:/Users/nicob/Desktop/Renovus/renovus/falconer_ui_web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\nicob\\\\Desktop\\\\Renovus\\\\renovus\\\\falconer_ui_web\\\\src\\\\views\\\\pages\\\\overview\\\\alerts.js\",\n    _this = this,\n    _s = $RefreshSig$();\n\nimport React, { lazy, useEffect, useState } from 'react';\nimport { CCard, CCardBody, CCardHeader, CCol, CRow, CSpinner, CWidgetDropdown, CCardTitle, CCardText } from '@coreui/react';\nimport CIcon from '@coreui/icons-react';\nimport DataAPI from '../../../helpers/DataAPI.js';\nimport { DateFilter, round, getDateLabel, getCurrentDateNDaysBefore } from '../../../helpers/utils.js';\nimport { setCookie, getCookie } from '../../../helpers/sessionCookie.js';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nvar Overview = function Overview() {\n  _s();\n\n  var _useState = useState(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      loading = _useState2[0],\n      setLoading = _useState2[1];\n\n  var _useState3 = useState(false),\n      _useState4 = _slicedToArray(_useState3, 2),\n      dataLoaded = _useState4[0],\n      setDataLoaded = _useState4[1];\n\n  var _useState5 = useState([]),\n      _useState6 = _slicedToArray(_useState5, 2),\n      generators = _useState6[0],\n      setGenerators = _useState6[1];\n\n  var _useState7 = useState([]),\n      _useState8 = _slicedToArray(_useState7, 2),\n      alert1 = _useState8[0],\n      setAlert1 = _useState8[1];\n\n  var _useState9 = useState([]),\n      _useState10 = _slicedToArray(_useState9, 2),\n      alert2 = _useState10[0],\n      setAlert2 = _useState10[1];\n\n  var _useState11 = useState([]),\n      _useState12 = _slicedToArray(_useState11, 2),\n      alert3 = _useState12[0],\n      setAlert3 = _useState12[1];\n\n  useEffect(function () {\n    loadGenerators();\n  }, []);\n\n  var loadGenerators = function loadGenerators() {\n    DataAPI({\n      'endpoint': 'admin/locations/current',\n      'method': 'GET'\n    }).then(function (response) {\n      if (response && response.error) {\n        setCookie('lastTimeStamp', '');\n        setCookie('name', '');\n        window.location.reload();\n      } else if (!dataLoaded && response && !response.error) {\n        var gen = [];\n        response.generators.forEach(function (generator) {\n          gen.push(generator.id);\n        });\n        setGenerators(gen);\n        fetchAlerts();\n      }\n    });\n  };\n\n  var fetchAlerts = function fetchAlerts() {\n    var body = {};\n    body.location = getCookie('location');\n    body.groupBy = \"day\";\n    body.period = \"cm\";\n    DataAPI({\n      'endpoint': 'chart/performanceIndex',\n      'method': 'POST',\n      'body': body\n    }).then(function (response) {\n      if (response.error) {\n        if (response.error.message) {\n          return alert(response.error.message);\n        } else {\n          return alert(response.error);\n        }\n      }\n\n      var generatorsAlert1 = [];\n      response.data.forEach(function (rDs) {\n        if (rDs.name != 'Total') {\n          if (rDs.data.performance.performanceIndex < 90) {\n            generatorsAlert1.push(rDs.name);\n          }\n        }\n      });\n      setAlert1(generatorsAlert1);\n    });\n    var body2 = {};\n    body2.location = getCookie('location');\n    body2.groupBy = \"day\";\n    body2.from = getCurrentDateNDaysBefore(\"-\", 2);\n    body2.to = getCurrentDateNDaysBefore(\"-\", 1);\n    DataAPI({\n      'endpoint': 'chart/performanceIndex',\n      'method': 'POST',\n      'body': body2\n    }).then(function (response) {\n      if (response.error) {\n        if (response.error.message) {\n          return alert(response.error.message);\n        } else {\n          return alert(response.error);\n        }\n      }\n\n      var generatorsAlert2 = [];\n      response.data.forEach(function (rDs) {\n        if (rDs.name != 'Total') {\n          var pIYesterday = rDs.data.graph[0].value;\n          var pIBeforeYesterday = rDs.data.graph[1].value;\n\n          if (pIBeforeYesterday - pIYesterday > 6) {\n            generatorsAlert2.push(rDs.name);\n          }\n        }\n      });\n      setAlert2(generatorsAlert2);\n    });\n    var body3 = {};\n    body3.location = getCookie('location');\n    body3.generators = generators;\n    body3.period = \"y\";\n    DataAPI({\n      'endpoint': 'chart/stopped',\n      'method': 'POST',\n      'body': body3\n    }).then(function (response) {\n      if (response.error) {\n        if (response.error.message) {\n          return alert(response.error.message);\n        } else {\n          return alert(response.error);\n        }\n      }\n\n      var generatorsAlert3 = [];\n      response.data.forEach(function (rDs) {\n        if (rDs.missingHours.split(\":\")[0] >= 10) {\n          generatorsAlert3.push(rDs.gen_code);\n        }\n      });\n      setAlert3(generatorsAlert3);\n    });\n  };\n\n  var options = {\n    animation: {\n      duration: loading ? 0 : 1000\n    }\n  };\n  var bodyOpacity = 1; //loading?.5:1\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: /*#__PURE__*/_jsxDEV(CCard, {\n      children: [/*#__PURE__*/_jsxDEV(CCardHeader, {\n        children: /*#__PURE__*/_jsxDEV(CRow, {\n          children: /*#__PURE__*/_jsxDEV(CCol, {\n            sm: \"9\",\n            children: /*#__PURE__*/_jsxDEV(\"h3\", {\n              id: \"traffic\",\n              className: \"card-title mb-0\",\n              children: \"Alerts\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 171,\n              columnNumber: 15\n            }, _this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 170,\n            columnNumber: 13\n          }, _this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 169,\n          columnNumber: 11\n        }, _this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 168,\n        columnNumber: 9\n      }, _this), /*#__PURE__*/_jsxDEV(CCardBody, {\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            opacity: bodyOpacity\n          },\n          children: [false && /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              zIndex: 999,\n              position: 'absolute',\n              width: '100%',\n              height: '100%',\n              backgroundColor: 'rgba(255,255,255,.7)'\n            },\n            children: /*#__PURE__*/_jsxDEV(CSpinner, {\n              style: {\n                position: 'absolute'\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 184,\n              columnNumber: 141\n            }, _this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 184,\n            columnNumber: 21\n          }, _this), /*#__PURE__*/_jsxDEV(CRow, {\n            children: /*#__PURE__*/_jsxDEV(CCol, {\n              sm: \"12\",\n              lg: \"6\",\n              children: /*#__PURE__*/_jsxDEV(CCard, {\n                color: \"danger\",\n                textColor: \"white\",\n                children: /*#__PURE__*/_jsxDEV(CCardBody, {\n                  children: [/*#__PURE__*/_jsxDEV(CCardTitle, {\n                    children: \"ALERTS\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 194,\n                    columnNumber: 19\n                  }, _this), /*#__PURE__*/_jsxDEV(CCardText, {\n                    children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                      class: \"\",\n                      children: [\"Wind turbines with performance < 90% (current month):\", /*#__PURE__*/_jsxDEV(\"h3\", {\n                        children: alert1.length > 0 ? alert1.join(' - ') : \" - \"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 197,\n                        columnNumber: 23\n                      }, _this)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 196,\n                      columnNumber: 21\n                    }, _this), /*#__PURE__*/_jsxDEV(\"p\", {\n                      class: \"\",\n                      children: [\"Wind turbines with negative change exceeding -6% in performance (yesterday):\", /*#__PURE__*/_jsxDEV(\"h3\", {\n                        children: alert2.length > 0 ? alert2.join(' - ') : \" - \"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 200,\n                        columnNumber: 23\n                      }, _this)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 199,\n                      columnNumber: 21\n                    }, _this), /*#__PURE__*/_jsxDEV(\"p\", {\n                      class: \"\",\n                      children: [\"Wind turbines with long stops (yesterday):\", /*#__PURE__*/_jsxDEV(\"h3\", {\n                        children: alert3.length > 0 ? alert3.join(' - ') : \" - \"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 203,\n                        columnNumber: 23\n                      }, _this)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 202,\n                      columnNumber: 21\n                    }, _this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 195,\n                    columnNumber: 19\n                  }, _this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 193,\n                  columnNumber: 17\n                }, _this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 188,\n                columnNumber: 15\n              }, _this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 187,\n              columnNumber: 13\n            }, _this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 186,\n            columnNumber: 11\n          }, _this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 182,\n          columnNumber: 9\n        }, _this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 180,\n        columnNumber: 9\n      }, _this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 167,\n      columnNumber: 7\n    }, _this)\n  }, void 0, false);\n};\n\n_s(Overview, \"yg+wqQi5aw15Rn91eoCKc2c7y70=\");\n\n_c = Overview;\nexport default Overview;\n\nvar _c;\n\n$RefreshReg$(_c, \"Overview\");","map":{"version":3,"sources":["C:/Users/nicob/Desktop/Renovus/renovus/falconer_ui_web/src/views/pages/overview/alerts.js"],"names":["React","lazy","useEffect","useState","CCard","CCardBody","CCardHeader","CCol","CRow","CSpinner","CWidgetDropdown","CCardTitle","CCardText","CIcon","DataAPI","DateFilter","round","getDateLabel","getCurrentDateNDaysBefore","setCookie","getCookie","Overview","loading","setLoading","dataLoaded","setDataLoaded","generators","setGenerators","alert1","setAlert1","alert2","setAlert2","alert3","setAlert3","loadGenerators","then","response","error","window","location","reload","gen","forEach","generator","push","id","fetchAlerts","body","groupBy","period","message","alert","generatorsAlert1","data","rDs","name","performance","performanceIndex","body2","from","to","generatorsAlert2","pIYesterday","graph","value","pIBeforeYesterday","body3","generatorsAlert3","missingHours","split","gen_code","options","animation","duration","bodyOpacity","opacity","zIndex","position","width","height","backgroundColor","length","join"],"mappings":"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","sourcesContent":["import React, { lazy, useEffect, useState } from 'react'\r\n\r\nimport {\r\n  CCard,\r\n  CCardBody,\r\n  CCardHeader,\r\n  CCol,\r\n  CRow,\r\n  CSpinner,\r\n  CWidgetDropdown,\r\n  CCardTitle,\r\n  CCardText\r\n} from '@coreui/react'\r\n\r\nimport CIcon from '@coreui/icons-react'\r\n\r\nimport DataAPI from '../../../helpers/DataAPI.js'\r\nimport {DateFilter, round, getDateLabel, getCurrentDateNDaysBefore} from '../../../helpers/utils.js'\r\nimport {setCookie,getCookie} from '../../../helpers/sessionCookie.js'\r\n\r\nconst Overview = () => {\r\n\r\n  const [loading, setLoading] = useState(false);\r\n  const [dataLoaded, setDataLoaded] = useState(false);\r\n  const [generators, setGenerators] = useState([]);\r\n\r\n  const [alert1, setAlert1] = useState([]);\r\n  const [alert2, setAlert2] = useState([]);\r\n  const [alert3, setAlert3] = useState([]);\r\n\r\n\r\n  useEffect(() => {\r\n    loadGenerators();\r\n  }, []);\r\n\r\n\r\n  const loadGenerators = () => {\r\n\r\n    DataAPI({\r\n      'endpoint': 'admin/locations/current',\r\n      'method': 'GET'\r\n    }).then(\r\n      response => {\r\n        \r\n        if (response && response.error) {\r\n          setCookie('lastTimeStamp', '');\r\n          setCookie('name', '');\r\n          window.location.reload();\r\n        }\r\n        else if (!dataLoaded && response  && !response.error) {\r\n          let gen = [];\r\n          response.generators.forEach(\r\n            generator => { \r\n              gen.push(generator.id)\r\n            })\r\n          setGenerators(gen);\r\n          fetchAlerts();\r\n        }\r\n      }\r\n    );\r\n  }\r\n\r\n\r\n  const fetchAlerts = () => {\r\n  \r\n    const body = {}\r\n    body.location = getCookie('location')\r\n    body.groupBy =\"day\"\r\n    body.period = \"cm\"\r\n    DataAPI({\r\n      'endpoint': 'chart/performanceIndex',\r\n      'method': 'POST',\r\n      'body': body\r\n    }).then(\r\n      response => {\r\n\r\n        if (response.error) {\r\n           if (response.error.message) {\r\n            return(alert(response.error.message))\r\n           } else {\r\n            return(alert(response.error)) \r\n           }\r\n        }\r\n\r\n        let generatorsAlert1 = []\r\n        response.data.forEach((rDs) => {\r\n          if (rDs.name!='Total') {\r\n            if (rDs.data.performance.performanceIndex < 90) {\r\n              generatorsAlert1.push(rDs.name)\r\n            }\r\n          }\r\n        });\r\n        setAlert1(generatorsAlert1)\r\n      }\r\n    );\r\n\r\n    const body2 = {}\r\n    body2.location = getCookie('location')\r\n    body2.groupBy =\"day\"\r\n    body2.from = getCurrentDateNDaysBefore(\"-\",2)\r\n    body2.to = getCurrentDateNDaysBefore(\"-\",1)\r\n    DataAPI({\r\n      'endpoint': 'chart/performanceIndex',\r\n      'method': 'POST',\r\n      'body': body2\r\n    }).then(\r\n      response => {\r\n\r\n        if (response.error) {\r\n           if (response.error.message) {\r\n            return(alert(response.error.message))\r\n           } else {\r\n            return(alert(response.error)) \r\n           }\r\n        }\r\n\r\n        let generatorsAlert2 = []\r\n        response.data.forEach((rDs) => {\r\n          if (rDs.name!='Total') {\r\n            const pIYesterday = rDs.data.graph[0].value\r\n            const pIBeforeYesterday = rDs.data.graph[1].value\r\n            if (pIBeforeYesterday - pIYesterday > 6) {\r\n              generatorsAlert2.push(rDs.name)\r\n            }\r\n          }\r\n        });\r\n        setAlert2(generatorsAlert2)\r\n      }\r\n    );\r\n\r\n    const body3 = {}\r\n    body3.location = getCookie('location')\r\n    body3.generators = generators\r\n    body3.period = \"y\"\r\n    DataAPI({\r\n      'endpoint': 'chart/stopped',\r\n      'method': 'POST',\r\n      'body': body3\r\n    }).then(\r\n      response => {\r\n\r\n        if (response.error) {\r\n           if (response.error.message) {\r\n            return(alert(response.error.message))\r\n           } else {\r\n            return(alert(response.error)) \r\n           }\r\n        }\r\n        let generatorsAlert3 = []\r\n        response.data.forEach((rDs) => {\r\n          if (rDs.missingHours.split(\":\")[0] >= 10) {\r\n            generatorsAlert3.push(rDs.gen_code)\r\n          }\r\n        });\r\n        setAlert3(generatorsAlert3)   \r\n        \r\n      }\r\n    );\r\n}\r\n\r\n  const options = {animation: {duration: loading ? 0 : 1000}};\r\n  const bodyOpacity = 1;//loading?.5:1\r\n\r\n  return (\r\n    <>\r\n      \r\n      <CCard>\r\n        <CCardHeader>\r\n          <CRow>\r\n            <CCol sm=\"9\">\r\n              <h3 id=\"traffic\" className=\"card-title mb-0\">\r\n                Alerts\r\n              </h3>\r\n              {/* <div className=\"small text-medium-emphasis\">{getDateLabel(dateRange)}</div> */}\r\n            </CCol>\r\n          </CRow>\r\n\r\n\r\n        </CCardHeader>\r\n        <CCardBody>\r\n\r\n        <div style={{opacity:bodyOpacity}}>\r\n\r\n          {false && <div style={{zIndex: 999, position: 'absolute', width: '100%', height: '100%', backgroundColor:'rgba(255,255,255,.7)'}}><CSpinner style={{position: 'absolute'}} /></div>}\r\n          \r\n          <CRow>\r\n            <CCol sm=\"12\" lg=\"6\">\r\n              <CCard\r\n                color={\"danger\"}\r\n                textColor={\"white\"}\r\n              >\r\n\r\n                <CCardBody>\r\n                  <CCardTitle>ALERTS</CCardTitle>\r\n                  <CCardText>\r\n                    <p class=\"\">Wind turbines with performance &lt; 90% (current month): \r\n                      <h3>{alert1.length > 0 ? alert1.join(' - ') : \" - \"}</h3>\r\n                    </p>\r\n                    <p class=\"\">Wind turbines with negative change exceeding -6% in performance (yesterday): \r\n                      <h3>{alert2.length > 0 ? alert2.join(' - ') : \" - \"}</h3>\r\n                    </p>\r\n                    <p class=\"\">Wind turbines with long stops (yesterday): \r\n                      <h3>{alert3.length > 0 ? alert3.join(' - ') : \" - \"}</h3>\r\n                    </p>\r\n                  </CCardText>\r\n                </CCardBody>\r\n              </CCard>\r\n\r\n\r\n            </CCol>\r\n          </CRow>\r\n\r\n        </div>\r\n        \r\n        </CCardBody>\r\n\r\n        </CCard>\r\n\r\n    </>\r\n  )\r\n}\r\n\r\nexport default Overview\r\n"]},"metadata":{},"sourceType":"module"}
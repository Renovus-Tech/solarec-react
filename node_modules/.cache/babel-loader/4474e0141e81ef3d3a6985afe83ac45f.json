{"ast":null,"code":"import _slicedToArray from \"C:/Users/nicob/Desktop/Renovus/renovus/falconer_ui_web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\nicob\\\\Desktop\\\\Renovus\\\\renovus\\\\falconer_ui_web\\\\src\\\\views\\\\pages\\\\solar\\\\climate\\\\forecast.js\",\n    _this = this,\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState, useRef } from 'react';\nimport DataAPI from '../../../../helpers/DataAPI.js';\nimport { round } from '../../../../helpers/utils.js';\nimport { setCookie, getCookie } from '../../../../helpers/sessionCookie.js';\nimport moment from 'moment-timezone';\nimport { CCard, CCardBody, CCardGroup, CCardHeader, CRow, CCol, CButton, CSpinner, CLabel } from '@coreui/react';\nimport { Chart, Plugin } from 'chart.js';\nimport { CChartLine } from '@coreui/react-chartjs';\nimport { Line } from 'react-chartjs-2';\nimport arrow from '../../../../assets/arrow.png';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar SolarClimateForecast = function SolarClimateForecast() {\n  _s();\n\n  var _useState = useState(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      dataLoaded = _useState2[0],\n      setDataLoaded = _useState2[1];\n\n  var _useState3 = useState(false),\n      _useState4 = _slicedToArray(_useState3, 2),\n      dataLoadError = _useState4[0],\n      setDataLoadError = _useState4[1];\n\n  var _useState5 = useState(true),\n      _useState6 = _slicedToArray(_useState5, 2),\n      loading = _useState6[0],\n      setLoading = _useState6[1];\n\n  var _useState7 = useState(null),\n      _useState8 = _slicedToArray(_useState7, 2),\n      arrowImage = _useState8[0],\n      setArrowImage = _useState8[1];\n\n  var _useState9 = useState([]),\n      _useState10 = _slicedToArray(_useState9, 2),\n      datetimes = _useState10[0],\n      _setDatetimes = _useState10[1];\n\n  var datetimesRef = useRef(datetimes);\n\n  var setDatetimes = function setDatetimes(datetimes) {\n    datetimesRef.current = datetimes;\n\n    _setDatetimes(datetimes);\n  };\n\n  var _useState11 = useState({\n    labels: [],\n    datasets: []\n  }),\n      _useState12 = _slicedToArray(_useState11, 2),\n      lineChartOneData = _useState12[0],\n      setLineChartOneData = _useState12[1];\n\n  useEffect(function () {\n    fetchData();\n  }, []);\n\n  var fetchData = function fetchData() {\n    setLoading(true);\n    var arrowImage = new Image(22, 22);\n    arrowImage.src = arrow;\n\n    arrowImage.onload = function () {\n      setArrowImage(this);\n    };\n\n    DataAPI({\n      'endpoint': 'solar/weather',\n      'method': 'GET'\n    }).then(function (response) {\n      setLoading(false);\n\n      if (response.error) {\n        setCookie('lastTimeStamp', '');\n        setCookie('name', '');\n        window.location.reload(); // if (response.error.message) {\n        //   return(alert(response.error.message))\n        // } else {\n        //   return(alert(response.error)) \n        // }\n      }\n\n      var graphData = {\n        labels: [],\n        datasets: []\n      };\n      var responseData = response.data;\n      graphData.labels = responseData.map(function (x, i) {\n        return x.values.find(function (y) {\n          return y.name == \"TYPE_WEATHER_RADIATION_FLUX\";\n        }).value;\n      });\n      var datasetIrradiance = {\n        label: '',\n        yAxisID: 'y',\n        borderColor: '#ff764a',\n        pointBackgroundColor: '#ef5675',\n        pointBorderColor: 'transparent',\n        backgroundColor: 'transparent',\n        data: responseData.map(function (x, i) {\n          return x.values.find(function (y) {\n            return y.name == \"TYPE_WEATHER_RADIATION_FLUX\";\n          }).value;\n        })\n      };\n      var datasetTemperature = {\n        label: '',\n        yAxisID: 'y1',\n        borderColor: '#0400ff',\n        pointBackgroundColor: '#0400ff',\n        pointBorderColor: 'transparent',\n        backgroundColor: 'transparent',\n        data: responseData.map(function (x, i) {\n          return x.values.find(function (y) {\n            return y.name == \"TYPE_WEATHER_RADIATION_FLUX\";\n          }).value;\n        })\n      };\n      graphData.datasets.push(datasetIrradiance);\n      graphData.datasets.push(datasetTemperature);\n      var datetimes = [];\n      responseData.forEach(function (x, i) {\n        datetimes.push(x.time);\n      });\n      setDatetimes(datetimes);\n      setLineChartOneData(graphData);\n      setLoading(false);\n    });\n  };\n\n  var plugins = [{\n    afterDraw: function afterDraw(chart) {\n      var ctx = chart.ctx;\n      var xAxis = chart.scales['x'];\n      var yAxis = chart.scales['y'];\n      xAxis.ticks.forEach(function (value, index) {\n        // if (index%6==0) {\n        var x = xAxis.getPixelForTick(index);\n        var datetime = datetimesRef.current[index].split(' ');\n        var date = datetime[0].split('-');\n        date = date[2] + \"-\" + date[1];\n        var time = datetime[1].split(':');\n\n        if (time[0] == '00' || time[0] == '06' || time[0] == '12' || time[0] == '18') {\n          time = time[0] + \":\" + time[1]; // const month = datetime.month()+1 > 9 ? datetime.month()+1 : '0'+(datetime.month()+1)\n          // const day = datetime.date() > 9 ? datetime.date() : '0'+datetime.date()\n          // const hour = datetime.hour() > 9 ? datetime.hour() : '0'+(datetime.hour())\n          // const minute = datetime.minutes() > 9 ? datetime.minutes() : '0'+datetime.minutes()\n          // const date = day+\"-\"+month\n          // const time = hour+\":\"+minute\n\n          ctx.font = \"9px Arial\";\n          ctx.fillText(date, x - 12, yAxis.bottom + 16);\n          ctx.fillText(time, x - 12, yAxis.bottom + 28);\n        } // }\n\n      });\n      ctx.font = \"12px Arial\";\n    }\n  }];\n  var options = {\n    type: 'line',\n    responsive: true,\n    animation: {\n      duration: loading ? 0 : 1000\n    },\n    tooltips: {\n      enabled: true\n    },\n    legend: {\n      display: false\n    },\n    elements: {\n      line: {\n        tension: .4\n      }\n    },\n    layout: {\n      padding: {\n        bottom: 80,\n        left: 20,\n        right: 20\n      }\n    },\n    scales: {\n      x: {\n        ticks: {\n          display: false\n        },\n        grid: {\n          display: true\n        }\n      },\n      y: {\n        min: 0,\n        beginAtZero: true\n      },\n      y1: {\n        position: 'right',\n        grid: {\n          drawOnChartArea: false // only want the grid lines for one axis to show up\n\n        }\n      }\n    },\n    plugins: {\n      tooltip: {\n        callbacks: {\n          title: function title(tooltipItem) {\n            return '';\n          },\n          label: function label(tooltipItem) {\n            var datetime = datetimesRef.current[tooltipItem.dataIndex].split(' ');\n            var date = datetime[0].split('-');\n            date = date[2] + \"-\" + date[1];\n            var time = datetime[1].split(':');\n            time = time[0] + \":\" + time[1];\n            return [\"Date: \" + date + \" \" + time, \"Irradiance: \" + round(tooltipItem.raw, 1) + ' W/m2'];\n          }\n        }\n      },\n      legend: {\n        display: false\n      }\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(CCard, {\n    children: [/*#__PURE__*/_jsxDEV(CCardHeader, {\n      children: /*#__PURE__*/_jsxDEV(CRow, {\n        children: [/*#__PURE__*/_jsxDEV(CCol, {\n          sm: \"4\",\n          children: /*#__PURE__*/_jsxDEV(\"h3\", {\n            id: \"traffic\",\n            className: \"card-title mb-0\",\n            children: \"Climate - Forecast\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 242,\n            columnNumber: 15\n          }, _this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 241,\n          columnNumber: 13\n        }, _this), /*#__PURE__*/_jsxDEV(CCol, {\n          sm: \"8\",\n          className: \"text-right d-flex flex-center flex-justify-end\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 248,\n          columnNumber: 13\n        }, _this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 240,\n        columnNumber: 11\n      }, _this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 239,\n      columnNumber: 7\n    }, _this), /*#__PURE__*/_jsxDEV(CCardBody, {\n      children: !loading || dataLoadError ? /*#__PURE__*/_jsxDEV(\"div\", {\n        children: /*#__PURE__*/_jsxDEV(CRow, {\n          className: 'mb-5',\n          children: /*#__PURE__*/_jsxDEV(CCol, {\n            children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n              className: \"pb-2 mb-4 border-bottom\",\n              children: \"Global Horizontal Irradiance\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 264,\n              columnNumber: 21\n            }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n              children: \"W/m2\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 265,\n              columnNumber: 21\n            }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"text-left float-left\",\n              style: {\n                width: '50%'\n              },\n              children: \"W/m2\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 266,\n              columnNumber: 21\n            }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"text-right float-right\",\n              style: {\n                width: '50%'\n              },\n              children: \"\\xACC\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 267,\n              columnNumber: 21\n            }, _this), /*#__PURE__*/_jsxDEV(Line, {\n              data: lineChartOneData,\n              options: options,\n              plugins: plugins\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 268,\n              columnNumber: 21\n            }, _this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 263,\n            columnNumber: 19\n          }, _this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 262,\n          columnNumber: 17\n        }, _this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 260,\n        columnNumber: 15\n      }, _this) : /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-center\",\n        children: /*#__PURE__*/_jsxDEV(CSpinner, {\n          className: \"loading-spinner\",\n          color: \"#321fdb\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 280,\n          columnNumber: 17\n        }, _this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 279,\n        columnNumber: 15\n      }, _this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 256,\n      columnNumber: 9\n    }, _this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 237,\n    columnNumber: 7\n  }, _this);\n};\n\n_s(SolarClimateForecast, \"fdWlVoIjSECLTouuNy8K3CMWlXA=\");\n\n_c = SolarClimateForecast;\nexport default SolarClimateForecast;\n\nvar _c;\n\n$RefreshReg$(_c, \"SolarClimateForecast\");","map":{"version":3,"sources":["C:/Users/nicob/Desktop/Renovus/renovus/falconer_ui_web/src/views/pages/solar/climate/forecast.js"],"names":["React","useEffect","useState","useRef","DataAPI","round","setCookie","getCookie","moment","CCard","CCardBody","CCardGroup","CCardHeader","CRow","CCol","CButton","CSpinner","CLabel","Chart","Plugin","CChartLine","Line","arrow","SolarClimateForecast","dataLoaded","setDataLoaded","dataLoadError","setDataLoadError","loading","setLoading","arrowImage","setArrowImage","datetimes","_setDatetimes","datetimesRef","setDatetimes","current","labels","datasets","lineChartOneData","setLineChartOneData","fetchData","Image","src","onload","then","response","error","window","location","reload","graphData","responseData","data","map","x","i","values","find","y","name","value","datasetIrradiance","label","yAxisID","borderColor","pointBackgroundColor","pointBorderColor","backgroundColor","datasetTemperature","push","forEach","time","plugins","afterDraw","chart","ctx","xAxis","scales","yAxis","ticks","index","getPixelForTick","datetime","split","date","font","fillText","bottom","options","type","responsive","animation","duration","tooltips","enabled","legend","display","elements","line","tension","layout","padding","left","right","grid","min","beginAtZero","y1","position","drawOnChartArea","tooltip","callbacks","title","tooltipItem","dataIndex","raw","width"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useRef } from 'react'\r\nimport DataAPI from '../../../../helpers/DataAPI.js'\r\nimport {round} from '../../../../helpers/utils.js'\r\nimport {setCookie,getCookie} from '../../../../helpers/sessionCookie.js'\r\nimport moment from 'moment-timezone';\r\n\r\nimport {\r\n  CCard,\r\n  CCardBody,\r\n  CCardGroup,\r\n  CCardHeader,\r\n  CRow,\r\n  CCol,\r\n  CButton,\r\n  CSpinner,\r\n  CLabel,\r\n} from '@coreui/react'\r\n\r\nimport {\r\n  Chart,\r\n  Plugin\r\n} from 'chart.js';\r\n\r\nimport { CChartLine } from '@coreui/react-chartjs'\r\n\r\nimport { Line } from 'react-chartjs-2'\r\n\r\nimport arrow from '../../../../assets/arrow.png'\r\n\r\n\r\nconst SolarClimateForecast = () => {\r\n\r\n  const [dataLoaded, setDataLoaded] = useState(false)\r\n  const [dataLoadError, setDataLoadError] = useState(false)\r\n  const [loading, setLoading] = useState(true)\r\n  const [arrowImage, setArrowImage] = useState(null)\r\n  const [datetimes, _setDatetimes] = useState([])\r\n  const datetimesRef = useRef(datetimes);\r\n  const setDatetimes = datetimes => {\r\n    datetimesRef.current = datetimes;\r\n    _setDatetimes(datetimes);\r\n  };\r\n\r\n  const [lineChartOneData, setLineChartOneData] = useState({\r\n    labels: [],\r\n    datasets: []\r\n  })\r\n\r\n  useEffect(() => {\r\n    fetchData();\r\n  }, []);\r\n\r\n  const fetchData = () => {\r\n\r\n    setLoading(true);\r\n\r\n    var arrowImage = new Image(22,22);\r\n    arrowImage.src = arrow\r\n    arrowImage.onload = function() {\r\n      setArrowImage(this);\r\n    }\r\n\r\n    DataAPI({\r\n      'endpoint': 'solar/weather',\r\n      'method': 'GET'\r\n    }).then(\r\n      response => {\r\n        setLoading(false);\r\n\r\n        if (response.error) {\r\n\r\n          setCookie('lastTimeStamp', '');\r\n          setCookie('name', '');\r\n          window.location.reload();\r\n\r\n          // if (response.error.message) {\r\n          //   return(alert(response.error.message))\r\n          // } else {\r\n          //   return(alert(response.error)) \r\n          // }\r\n        }\r\n\r\n        const graphData = {\r\n          labels: [],\r\n          datasets: []\r\n        }\r\n\r\n        const responseData = response.data;\r\n\r\n        graphData.labels = responseData.map( (x,i) => {\r\n          return x.values.find(y => y.name == \"TYPE_WEATHER_RADIATION_FLUX\").value;\r\n        })\r\n  \r\n        const datasetIrradiance = {\r\n          label:  '',\r\n          yAxisID: 'y',\r\n          borderColor: '#ff764a',\r\n          pointBackgroundColor: '#ef5675',\r\n          pointBorderColor: 'transparent',\r\n          backgroundColor: 'transparent',\r\n          data: responseData.map( (x,i) => {\r\n            return x.values.find(y => y.name == \"TYPE_WEATHER_RADIATION_FLUX\").value;\r\n          })\r\n        }\r\n\r\n        const datasetTemperature = {\r\n          label:  '',\r\n          yAxisID: 'y1',\r\n          borderColor: '#0400ff',\r\n          pointBackgroundColor: '#0400ff',\r\n          pointBorderColor: 'transparent',\r\n          backgroundColor: 'transparent',\r\n          data: responseData.map( (x,i) => {\r\n            return x.values.find(y => y.name == \"TYPE_WEATHER_RADIATION_FLUX\").value;\r\n          })\r\n        }\r\n\r\n        graphData.datasets.push(datasetIrradiance);\r\n        graphData.datasets.push(datasetTemperature);\r\n  \r\n        const datetimes = []\r\n        responseData.forEach( (x,i) => {\r\n          datetimes.push(x.time);\r\n        })\r\n        setDatetimes(datetimes)\r\n        \r\n        setLineChartOneData(graphData)\r\n\r\n        setLoading(false)\r\n\r\n      })\r\n\r\n  }\r\n\r\n  const plugins = [{\r\n    afterDraw: (chart) => {\r\n      let ctx = chart.ctx;\r\n      var xAxis = chart.scales['x'];\r\n      var yAxis = chart.scales['y'];\r\n      xAxis.ticks.forEach((value, index) => {\r\n        \r\n        // if (index%6==0) {\r\n          var x = xAxis.getPixelForTick(index);\r\n        \r\n          const datetime = datetimesRef.current[index].split(' ')\r\n          let date = datetime[0].split('-')\r\n          date = date[2] + \"-\" + date[1]\r\n          let time = datetime[1].split(':')\r\n          if (time[0] == '00' || time[0] == '06' || time[0] == '12' || time[0] == '18' ) {\r\n            time = time[0] + \":\" + time[1]\r\n            // const month = datetime.month()+1 > 9 ? datetime.month()+1 : '0'+(datetime.month()+1)\r\n            // const day = datetime.date() > 9 ? datetime.date() : '0'+datetime.date()\r\n            // const hour = datetime.hour() > 9 ? datetime.hour() : '0'+(datetime.hour())\r\n            // const minute = datetime.minutes() > 9 ? datetime.minutes() : '0'+datetime.minutes()\r\n            // const date = day+\"-\"+month\r\n            // const time = hour+\":\"+minute\r\n            \r\n            ctx.font = \"9px Arial\";\r\n            ctx.fillText(date, x - 12, yAxis.bottom + 16);\r\n          ctx.fillText(time, x - 12, yAxis.bottom + 28);\r\n          }\r\n          \r\n        // }\r\n      });\r\n      ctx.font = \"12px Arial\";\r\n    }\r\n  }]\r\n\r\n\r\n  const options =  {\r\n    type: 'line',\r\n    responsive: true,\r\n    animation: {duration: loading ? 0 : 1000},\r\n    tooltips: {\r\n      enabled: true\r\n    },\r\n    legend: {\r\n      display: false\r\n    },\r\n    elements: {\r\n      line: {\r\n          tension: .4\r\n      }\r\n    },\r\n    layout: {\r\n        padding: {\r\n            bottom: 80,\r\n            left: 20,\r\n            right: 20\r\n        }\r\n    },\r\n    scales: {\r\n      x: {\r\n        ticks: {\r\n            display: false,\r\n        },\r\n        grid: {\r\n          display: true\r\n        },\r\n      },\r\n      y: {\r\n        min: 0,\r\n        beginAtZero: true\r\n      },\r\n      y1: {\r\n        position: 'right',\r\n        grid: {\r\n          drawOnChartArea: false, // only want the grid lines for one axis to show up\r\n        },\r\n      },\r\n    },\r\n    plugins: {\r\n      tooltip: {\r\n        callbacks: {\r\n          title: function(tooltipItem){\r\n            return '';\r\n          },\r\n          label: function(tooltipItem) {\r\n            const datetime = datetimesRef.current[tooltipItem.dataIndex].split(' ')\r\n            let date = datetime[0].split('-')\r\n            date = date[2] + \"-\" + date[1]\r\n            let time = datetime[1].split(':')\r\n            time = time[0] + \":\" + time[1]\r\n            return [\"Date: \"+date+\" \"+time,\"Irradiance: \"+round(tooltipItem.raw,1) + ' W/m2']\r\n          }\r\n        }\r\n      },\r\n      legend: {\r\n        display: false\r\n      },\r\n    }\r\n  };\r\n\r\n\r\n  return (\r\n\r\n      <CCard>\r\n\r\n      <CCardHeader>\r\n          <CRow>\r\n            <CCol sm=\"4\">\r\n              <h3 id=\"traffic\" className=\"card-title mb-0\">\r\n                Climate - Forecast\r\n              </h3>\r\n              {/* <div className=\"small text-medium-emphasis\">{getDateLabel(dateRange)}</div> */}\r\n            </CCol>\r\n\r\n            <CCol sm=\"8\" className=\"text-right d-flex flex-center flex-justify-end\">\r\n              {/* <h6 className=\"mr-2 ml-4 m-0\" style={{lineHeight:1.2}}>Period</h6>\r\n              <DateFilter options={['y','cm','cy','x','xx']} disabled={loading} onChange={(value) => { setDateRange(value); }} /> */}\r\n            </CCol>\r\n          </CRow>\r\n\r\n        </CCardHeader>\r\n\r\n        <CCardBody>\r\n\r\n            {!loading || dataLoadError ? \r\n\r\n              <div>\r\n\r\n                <CRow className={'mb-5'}>\r\n                  <CCol>\r\n                    <h4 className=\"pb-2 mb-4 border-bottom\" >Global Horizontal Irradiance</h4>\r\n                    <div>W/m2</div>\r\n                    <div className=\"text-left float-left\" style={{width: '50%'}}>W/m2</div>\r\n                    <div className=\"text-right float-right\" style={{width: '50%'}}>¬C</div>\r\n                    <Line\r\n                      data={lineChartOneData}\r\n                      options={options}\r\n                      plugins={plugins}\r\n                    />\r\n                  </CCol>\r\n                </CRow>\r\n\r\n\r\n              </div>\r\n            : \r\n              <div className='text-center'>\r\n                <CSpinner \r\n                  className=\"loading-spinner\"\r\n                  color='#321fdb'\r\n                />\r\n              </div>\r\n            }\r\n\r\n        </CCardBody>\r\n      </CCard>\r\n\r\n  )\r\n}\r\n\r\nexport default SolarClimateForecast\r\n"]},"metadata":{},"sourceType":"module"}
{"ast":null,"code":"import _slicedToArray from \"C:/Users/nicob/Desktop/Renovus/renovus/falconer_ui_web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\nicob\\\\Desktop\\\\Renovus\\\\renovus\\\\falconer_ui_web\\\\src\\\\views\\\\pages\\\\wind\\\\overview\\\\alerts.js\",\n    _this = this,\n    _s = $RefreshSig$();\n\nimport React, { lazy, useEffect, useState } from 'react';\nimport { CCard, CCardBody, CCardHeader, CCol, CRow, CSpinner, CWidgetDropdown, CCardTitle, CCardText } from '@coreui/react';\nimport CIcon from '@coreui/icons-react';\nimport DataAPI from '../../../../helpers/DataAPI.js';\nimport { DateFilter, round, getDateLabel, getCurrentDateNDaysBefore } from '../../../../helpers/utils.js';\nimport { setCookie, getCookie } from '../../../../helpers/sessionCookie.js';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nvar Overview = function Overview() {\n  _s();\n\n  var _useState = useState(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      loading = _useState2[0],\n      setLoading = _useState2[1];\n\n  var _useState3 = useState(true),\n      _useState4 = _slicedToArray(_useState3, 2),\n      loading1 = _useState4[0],\n      setLoading1 = _useState4[1];\n\n  var _useState5 = useState(false),\n      _useState6 = _slicedToArray(_useState5, 2),\n      loading2 = _useState6[0],\n      setLoading2 = _useState6[1];\n\n  var _useState7 = useState(false),\n      _useState8 = _slicedToArray(_useState7, 2),\n      loading3 = _useState8[0],\n      setLoading3 = _useState8[1];\n\n  var _useState9 = useState(false),\n      _useState10 = _slicedToArray(_useState9, 2),\n      loading4 = _useState10[0],\n      setLoading4 = _useState10[1];\n\n  var _useState11 = useState(false),\n      _useState12 = _slicedToArray(_useState11, 2),\n      dataLoaded = _useState12[0],\n      setDataLoaded = _useState12[1];\n\n  var _useState13 = useState([]),\n      _useState14 = _slicedToArray(_useState13, 2),\n      generators = _useState14[0],\n      setGenerators = _useState14[1];\n\n  var _useState15 = useState([]),\n      _useState16 = _slicedToArray(_useState15, 2),\n      alert1 = _useState16[0],\n      setAlert1 = _useState16[1];\n\n  var _useState17 = useState([]),\n      _useState18 = _slicedToArray(_useState17, 2),\n      alert2 = _useState18[0],\n      setAlert2 = _useState18[1];\n\n  var _useState19 = useState([]),\n      _useState20 = _slicedToArray(_useState19, 2),\n      alert3 = _useState20[0],\n      setAlert3 = _useState20[1];\n\n  var _useState21 = useState([]),\n      _useState22 = _slicedToArray(_useState21, 2),\n      alert4 = _useState22[0],\n      setAlert4 = _useState22[1];\n\n  useEffect(function () {\n    loadGenerators();\n  }, []);\n\n  var loadGenerators = function loadGenerators() {\n    DataAPI({\n      'endpoint': 'admin/locations/current',\n      'method': 'GET'\n    }).then(function (response) {\n      if (response && response.error) {\n        setCookie('lastTimeStamp', '');\n        setCookie('name', '');\n        window.location.reload();\n      } else if (!dataLoaded && response && !response.error) {\n        var gen = [];\n\n        if (response.generators != null) {\n          response.generators.forEach(function (generator) {\n            gen.push(generator.id);\n          });\n          setGenerators(gen);\n        }\n\n        fetchAlerts();\n      }\n    });\n  };\n\n  var fetchAlerts = function fetchAlerts() {\n    var body = {};\n    body.location = getCookie('location');\n    body.groupBy = \"day\";\n    body.period = \"cm\";\n    DataAPI({\n      'endpoint': 'chart/performanceIndex',\n      'method': 'POST',\n      'body': body\n    }).then(function (response) {\n      setLoading1(false);\n\n      if (response.error) {\n        if (response.error.message) {\n          return alert(response.error.message);\n        } else {\n          return alert(response.error);\n        }\n      }\n\n      var generatorsAlert1 = [];\n      response.data.forEach(function (rDs) {\n        if (rDs.name != 'Total') {\n          if (rDs.data.performance.performanceIndex < 90) {\n            generatorsAlert1.push(rDs.code);\n          }\n        }\n      });\n      setAlert1(generatorsAlert1);\n    });\n    var body2 = {};\n    body2.location = getCookie('location');\n    body2.groupBy = \"day\";\n    body2.from = getCurrentDateNDaysBefore(\"-\", 2);\n    body2.to = getCurrentDateNDaysBefore(\"-\", 1);\n    DataAPI({\n      'endpoint': 'chart/performanceIndex',\n      'method': 'POST',\n      'body': body2\n    }).then(function (response) {\n      setLoading2(false);\n\n      if (response.error) {\n        if (response.error.message) {\n          return alert(response.error.message);\n        } else {\n          return alert(response.error);\n        }\n      }\n\n      var generatorsAlert2 = [];\n      response.data.forEach(function (rDs) {\n        if (rDs.name != 'Total') {\n          var pIYesterday = rDs.data.graph[0].value;\n          var pIBeforeYesterday = rDs.data.graph[1].value;\n\n          if (pIBeforeYesterday - pIYesterday > 6) {\n            generatorsAlert2.push(rDs.code);\n          }\n        }\n      });\n      setAlert2(generatorsAlert2);\n    });\n    var body3 = {};\n    body3.location = getCookie('location');\n    body3.generators = generators;\n    body3.period = \"y\";\n    DataAPI({\n      'endpoint': 'chart/stopped',\n      'method': 'POST',\n      'body': body3\n    }).then(function (response) {\n      setLoading3(false);\n\n      if (response.error) {\n        if (response.error.message) {\n          return alert(response.error.message);\n        } else {\n          return alert(response.error);\n        }\n      }\n\n      var generatorsAlert3 = [];\n      response.data.forEach(function (rDs) {\n        if (rDs.missingHours.split(\":\")[0] >= 10) {\n          generatorsAlert3.push(rDs.gen_code);\n        }\n      });\n      setAlert3(generatorsAlert3);\n    });\n    var body4 = {};\n    body4.location = getCookie('location');\n    body4.generators = generators;\n    body4.groupBy = \"day\";\n    body4.period = \"y\";\n    DataAPI({\n      'endpoint': 'chart/dataAvailability',\n      'method': 'POST',\n      'body': body4\n    }).then(function (response) {\n      setLoading4(false);\n\n      if (response.error) {\n        if (response.error.message) {\n          return alert(response.error.message);\n        } else {\n          return alert(response.error);\n        }\n      }\n\n      var generatorsAlert4 = [];\n      response.data.table.forEach(function (rDs) {\n        if (rDs.total.turbineData < 90) generatorsAlert4.push(\"Turbine XX\");\n        if (rDs.metMast.direction < 90) generatorsAlert4.push(\"Met Mast Wind Direction\");\n        if (rDs.metMast.speed < 90) generatorsAlert4.push(\"Met Mast Wind Speed\");\n        if (rDs.metMast.temperature < 90) generatorsAlert4.push(\"Met Mast Temperature\");\n        if (rDs.metMast.pressure < 90) generatorsAlert4.push(\"Met Mast Pressure\");\n        if (rDs.metMast.humidity < 90) generatorsAlert4.push(\"Met Mast Humidity\");\n        if (rDs.turbineState.state < 90) generatorsAlert4.push(\"Grid Curtailment Status\");\n      });\n      setAlert4(generatorsAlert4);\n    });\n  };\n\n  var options = {\n    animation: {\n      duration: loading ? 0 : 1000\n    }\n  };\n  var bodyOpacity = 1; //loading?.5:1\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: /*#__PURE__*/_jsxDEV(CCard, {\n      children: [/*#__PURE__*/_jsxDEV(CCardHeader, {\n        children: /*#__PURE__*/_jsxDEV(CRow, {\n          children: /*#__PURE__*/_jsxDEV(CCol, {\n            sm: \"9\",\n            children: /*#__PURE__*/_jsxDEV(\"h3\", {\n              id: \"traffic\",\n              className: \"card-title mb-0\",\n              children: \"Alerts\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 220,\n              columnNumber: 15\n            }, _this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 219,\n            columnNumber: 13\n          }, _this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 218,\n          columnNumber: 11\n        }, _this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 217,\n        columnNumber: 9\n      }, _this), /*#__PURE__*/_jsxDEV(CCardBody, {\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            opacity: bodyOpacity\n          },\n          children: [false && /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              zIndex: 999,\n              position: 'absolute',\n              width: '100%',\n              height: '100%',\n              backgroundColor: 'rgba(255,255,255,.7)'\n            },\n            children: /*#__PURE__*/_jsxDEV(CSpinner, {\n              style: {\n                position: 'absolute'\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 233,\n              columnNumber: 141\n            }, _this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 233,\n            columnNumber: 21\n          }, _this), /*#__PURE__*/_jsxDEV(CRow, {\n            children: /*#__PURE__*/_jsxDEV(CCol, {\n              sm: \"12\",\n              lg: \"6\",\n              children: /*#__PURE__*/_jsxDEV(CCard, {\n                color: \"danger\",\n                textColor: \"white\",\n                children: [/*#__PURE__*/_jsxDEV(CCardHeader, {\n                  children: /*#__PURE__*/_jsxDEV(CRow, {\n                    children: /*#__PURE__*/_jsxDEV(CCol, {\n                      children: /*#__PURE__*/_jsxDEV(\"h4\", {\n                        id: \"traffic\",\n                        className: \"card-title mb-0\",\n                        children: \"ALERTS\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 244,\n                        columnNumber: 23\n                      }, _this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 243,\n                      columnNumber: 21\n                    }, _this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 242,\n                    columnNumber: 19\n                  }, _this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 241,\n                  columnNumber: 17\n                }, _this), /*#__PURE__*/_jsxDEV(CCardBody, {\n                  children: /*#__PURE__*/_jsxDEV(CCardText, {\n                    children: [loading1 ? /*#__PURE__*/_jsxDEV(\"div\", {\n                      className: \"text-center\",\n                      children: /*#__PURE__*/_jsxDEV(CSpinner, {\n                        className: \"loading-spinner\",\n                        color: \"#321fdb\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 255,\n                        columnNumber: 23\n                      }, _this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 254,\n                      columnNumber: 22\n                    }, _this) : /*#__PURE__*/_jsxDEV(\"p\", {\n                      class: \"\",\n                      children: [\"Wind turbines with performance < 90% (current month):\", /*#__PURE__*/_jsxDEV(\"h3\", {\n                        children: alert1.length > 0 ? alert1.join(' - ') : \" - \"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 262,\n                        columnNumber: 25\n                      }, _this)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 261,\n                      columnNumber: 23\n                    }, _this), /*#__PURE__*/_jsxDEV(\"p\", {\n                      class: \"\",\n                      children: [\"Wind turbines with negative change exceeding -6% in performance (yesterday):\", /*#__PURE__*/_jsxDEV(\"h3\", {\n                        children: alert2.length > 0 ? alert2.join(' - ') : \" - \"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 266,\n                        columnNumber: 23\n                      }, _this)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 265,\n                      columnNumber: 21\n                    }, _this), /*#__PURE__*/_jsxDEV(\"p\", {\n                      class: \"\",\n                      children: [\"Wind turbines with long stops (yesterday):\", /*#__PURE__*/_jsxDEV(\"h3\", {\n                        children: alert3.length > 0 ? alert3.join(' - ') : \" - \"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 269,\n                        columnNumber: 23\n                      }, _this)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 268,\n                      columnNumber: 21\n                    }, _this), /*#__PURE__*/_jsxDEV(\"p\", {\n                      class: \"\",\n                      children: [\"< 90% data available (yesterday):\", /*#__PURE__*/_jsxDEV(\"h4\", {\n                        children: alert4.length > 0 ? alert4.map(function (s) {\n                          return /*#__PURE__*/_jsxDEV(React.Fragment, {\n                            children: [s, /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                              fileName: _jsxFileName,\n                              lineNumber: 272,\n                              columnNumber: 81\n                            }, _this)]\n                          }, void 0, true, {\n                            fileName: _jsxFileName,\n                            lineNumber: 272,\n                            columnNumber: 62\n                          }, _this);\n                        }) : \" - \"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 272,\n                        columnNumber: 23\n                      }, _this)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 271,\n                      columnNumber: 21\n                    }, _this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 252,\n                    columnNumber: 19\n                  }, _this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 250,\n                  columnNumber: 17\n                }, _this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 237,\n                columnNumber: 15\n              }, _this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 236,\n              columnNumber: 13\n            }, _this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 235,\n            columnNumber: 11\n          }, _this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 231,\n          columnNumber: 9\n        }, _this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 229,\n        columnNumber: 9\n      }, _this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 216,\n      columnNumber: 7\n    }, _this)\n  }, void 0, false);\n};\n\n_s(Overview, \"fBx9SWG1flqghki8UMo7Ey56X4Y=\");\n\n_c = Overview;\nexport default Overview;\n\nvar _c;\n\n$RefreshReg$(_c, \"Overview\");","map":{"version":3,"sources":["C:/Users/nicob/Desktop/Renovus/renovus/falconer_ui_web/src/views/pages/wind/overview/alerts.js"],"names":["React","lazy","useEffect","useState","CCard","CCardBody","CCardHeader","CCol","CRow","CSpinner","CWidgetDropdown","CCardTitle","CCardText","CIcon","DataAPI","DateFilter","round","getDateLabel","getCurrentDateNDaysBefore","setCookie","getCookie","Overview","loading","setLoading","loading1","setLoading1","loading2","setLoading2","loading3","setLoading3","loading4","setLoading4","dataLoaded","setDataLoaded","generators","setGenerators","alert1","setAlert1","alert2","setAlert2","alert3","setAlert3","alert4","setAlert4","loadGenerators","then","response","error","window","location","reload","gen","forEach","generator","push","id","fetchAlerts","body","groupBy","period","message","alert","generatorsAlert1","data","rDs","name","performance","performanceIndex","code","body2","from","to","generatorsAlert2","pIYesterday","graph","value","pIBeforeYesterday","body3","generatorsAlert3","missingHours","split","gen_code","body4","generatorsAlert4","table","total","turbineData","metMast","direction","speed","temperature","pressure","humidity","turbineState","state","options","animation","duration","bodyOpacity","opacity","zIndex","position","width","height","backgroundColor","length","join","map","s"],"mappings":";;;;;;AAAA,OAAOA,KAAP,IAAgBC,IAAhB,EAAsBC,SAAtB,EAAiCC,QAAjC,QAAiD,OAAjD;AAEA,SACEC,KADF,EAEEC,SAFF,EAGEC,WAHF,EAIEC,IAJF,EAKEC,IALF,EAMEC,QANF,EAOEC,eAPF,EAQEC,UARF,EASEC,SATF,QAUO,eAVP;AAYA,OAAOC,KAAP,MAAkB,qBAAlB;AAEA,OAAOC,OAAP,MAAoB,gCAApB;AACA,SAAQC,UAAR,EAAoBC,KAApB,EAA2BC,YAA3B,EAAyCC,yBAAzC,QAAyE,8BAAzE;AACA,SAAQC,SAAR,EAAkBC,SAAlB,QAAkC,sCAAlC;;;;AAEA,IAAMC,QAAQ,GAAG,SAAXA,QAAW,GAAM;AAAA;;AAErB,kBAA8BlB,QAAQ,CAAC,KAAD,CAAtC;AAAA;AAAA,MAAOmB,OAAP;AAAA,MAAgBC,UAAhB;;AACA,mBAAgCpB,QAAQ,CAAC,IAAD,CAAxC;AAAA;AAAA,MAAOqB,QAAP;AAAA,MAAiBC,WAAjB;;AACA,mBAAgCtB,QAAQ,CAAC,KAAD,CAAxC;AAAA;AAAA,MAAOuB,QAAP;AAAA,MAAiBC,WAAjB;;AACA,mBAAgCxB,QAAQ,CAAC,KAAD,CAAxC;AAAA;AAAA,MAAOyB,QAAP;AAAA,MAAiBC,WAAjB;;AACA,mBAAgC1B,QAAQ,CAAC,KAAD,CAAxC;AAAA;AAAA,MAAO2B,QAAP;AAAA,MAAiBC,WAAjB;;AACA,oBAAoC5B,QAAQ,CAAC,KAAD,CAA5C;AAAA;AAAA,MAAO6B,UAAP;AAAA,MAAmBC,aAAnB;;AACA,oBAAoC9B,QAAQ,CAAC,EAAD,CAA5C;AAAA;AAAA,MAAO+B,UAAP;AAAA,MAAmBC,aAAnB;;AAEA,oBAA4BhC,QAAQ,CAAC,EAAD,CAApC;AAAA;AAAA,MAAOiC,MAAP;AAAA,MAAeC,SAAf;;AACA,oBAA4BlC,QAAQ,CAAC,EAAD,CAApC;AAAA;AAAA,MAAOmC,MAAP;AAAA,MAAeC,SAAf;;AACA,oBAA4BpC,QAAQ,CAAC,EAAD,CAApC;AAAA;AAAA,MAAOqC,MAAP;AAAA,MAAeC,SAAf;;AACA,oBAA4BtC,QAAQ,CAAC,EAAD,CAApC;AAAA;AAAA,MAAOuC,MAAP;AAAA,MAAeC,SAAf;;AAGAzC,EAAAA,SAAS,CAAC,YAAM;AACd0C,IAAAA,cAAc;AACf,GAFQ,EAEN,EAFM,CAAT;;AAKA,MAAMA,cAAc,GAAG,SAAjBA,cAAiB,GAAM;AAE3B9B,IAAAA,OAAO,CAAC;AACN,kBAAY,yBADN;AAEN,gBAAU;AAFJ,KAAD,CAAP,CAGG+B,IAHH,CAIE,UAAAC,QAAQ,EAAI;AAEV,UAAIA,QAAQ,IAAIA,QAAQ,CAACC,KAAzB,EAAgC;AAC9B5B,QAAAA,SAAS,CAAC,eAAD,EAAkB,EAAlB,CAAT;AACAA,QAAAA,SAAS,CAAC,MAAD,EAAS,EAAT,CAAT;AACA6B,QAAAA,MAAM,CAACC,QAAP,CAAgBC,MAAhB;AACD,OAJD,MAKK,IAAI,CAAClB,UAAD,IAAec,QAAf,IAA4B,CAACA,QAAQ,CAACC,KAA1C,EAAiD;AACpD,YAAII,GAAG,GAAG,EAAV;;AACA,YAAIL,QAAQ,CAACZ,UAAT,IAAuB,IAA3B,EAAiC;AAC/BY,UAAAA,QAAQ,CAACZ,UAAT,CAAoBkB,OAApB,CACE,UAAAC,SAAS,EAAI;AACXF,YAAAA,GAAG,CAACG,IAAJ,CAASD,SAAS,CAACE,EAAnB;AACD,WAHH;AAIApB,UAAAA,aAAa,CAACgB,GAAD,CAAb;AACD;;AACDK,QAAAA,WAAW;AACZ;AACF,KAtBH;AAwBD,GA1BD;;AA6BA,MAAMA,WAAW,GAAG,SAAdA,WAAc,GAAM;AAExB,QAAMC,IAAI,GAAG,EAAb;AACAA,IAAAA,IAAI,CAACR,QAAL,GAAgB7B,SAAS,CAAC,UAAD,CAAzB;AACAqC,IAAAA,IAAI,CAACC,OAAL,GAAc,KAAd;AACAD,IAAAA,IAAI,CAACE,MAAL,GAAc,IAAd;AACA7C,IAAAA,OAAO,CAAC;AACN,kBAAY,wBADN;AAEN,gBAAU,MAFJ;AAGN,cAAQ2C;AAHF,KAAD,CAAP,CAIGZ,IAJH,CAKE,UAAAC,QAAQ,EAAI;AAEVrB,MAAAA,WAAW,CAAC,KAAD,CAAX;;AAEA,UAAIqB,QAAQ,CAACC,KAAb,EAAoB;AACjB,YAAID,QAAQ,CAACC,KAAT,CAAea,OAAnB,EAA4B;AAC3B,iBAAOC,KAAK,CAACf,QAAQ,CAACC,KAAT,CAAea,OAAhB,CAAZ;AACA,SAFD,MAEO;AACN,iBAAOC,KAAK,CAACf,QAAQ,CAACC,KAAV,CAAZ;AACA;AACH;;AAED,UAAIe,gBAAgB,GAAG,EAAvB;AACAhB,MAAAA,QAAQ,CAACiB,IAAT,CAAcX,OAAd,CAAsB,UAACY,GAAD,EAAS;AAC7B,YAAIA,GAAG,CAACC,IAAJ,IAAU,OAAd,EAAuB;AACrB,cAAID,GAAG,CAACD,IAAJ,CAASG,WAAT,CAAqBC,gBAArB,GAAwC,EAA5C,EAAgD;AAC9CL,YAAAA,gBAAgB,CAACR,IAAjB,CAAsBU,GAAG,CAACI,IAA1B;AACD;AACF;AACF,OAND;AAOA/B,MAAAA,SAAS,CAACyB,gBAAD,CAAT;AACD,KA1BH;AA6BA,QAAMO,KAAK,GAAG,EAAd;AACAA,IAAAA,KAAK,CAACpB,QAAN,GAAiB7B,SAAS,CAAC,UAAD,CAA1B;AACAiD,IAAAA,KAAK,CAACX,OAAN,GAAe,KAAf;AACAW,IAAAA,KAAK,CAACC,IAAN,GAAapD,yBAAyB,CAAC,GAAD,EAAK,CAAL,CAAtC;AACAmD,IAAAA,KAAK,CAACE,EAAN,GAAWrD,yBAAyB,CAAC,GAAD,EAAK,CAAL,CAApC;AACAJ,IAAAA,OAAO,CAAC;AACN,kBAAY,wBADN;AAEN,gBAAU,MAFJ;AAGN,cAAQuD;AAHF,KAAD,CAAP,CAIGxB,IAJH,CAKE,UAAAC,QAAQ,EAAI;AAEVnB,MAAAA,WAAW,CAAC,KAAD,CAAX;;AAEA,UAAImB,QAAQ,CAACC,KAAb,EAAoB;AACjB,YAAID,QAAQ,CAACC,KAAT,CAAea,OAAnB,EAA4B;AAC3B,iBAAOC,KAAK,CAACf,QAAQ,CAACC,KAAT,CAAea,OAAhB,CAAZ;AACA,SAFD,MAEO;AACN,iBAAOC,KAAK,CAACf,QAAQ,CAACC,KAAV,CAAZ;AACA;AACH;;AAED,UAAIyB,gBAAgB,GAAG,EAAvB;AACA1B,MAAAA,QAAQ,CAACiB,IAAT,CAAcX,OAAd,CAAsB,UAACY,GAAD,EAAS;AAC7B,YAAIA,GAAG,CAACC,IAAJ,IAAU,OAAd,EAAuB;AACrB,cAAMQ,WAAW,GAAGT,GAAG,CAACD,IAAJ,CAASW,KAAT,CAAe,CAAf,EAAkBC,KAAtC;AACA,cAAMC,iBAAiB,GAAGZ,GAAG,CAACD,IAAJ,CAASW,KAAT,CAAe,CAAf,EAAkBC,KAA5C;;AACA,cAAIC,iBAAiB,GAAGH,WAApB,GAAkC,CAAtC,EAAyC;AACvCD,YAAAA,gBAAgB,CAAClB,IAAjB,CAAsBU,GAAG,CAACI,IAA1B;AACD;AACF;AACF,OARD;AASA7B,MAAAA,SAAS,CAACiC,gBAAD,CAAT;AACD,KA5BH;AA+BA,QAAMK,KAAK,GAAG,EAAd;AACAA,IAAAA,KAAK,CAAC5B,QAAN,GAAiB7B,SAAS,CAAC,UAAD,CAA1B;AACAyD,IAAAA,KAAK,CAAC3C,UAAN,GAAmBA,UAAnB;AACA2C,IAAAA,KAAK,CAAClB,MAAN,GAAe,GAAf;AACA7C,IAAAA,OAAO,CAAC;AACN,kBAAY,eADN;AAEN,gBAAU,MAFJ;AAGN,cAAQ+D;AAHF,KAAD,CAAP,CAIGhC,IAJH,CAKE,UAAAC,QAAQ,EAAI;AAEVjB,MAAAA,WAAW,CAAC,KAAD,CAAX;;AAEA,UAAIiB,QAAQ,CAACC,KAAb,EAAoB;AACjB,YAAID,QAAQ,CAACC,KAAT,CAAea,OAAnB,EAA4B;AAC3B,iBAAOC,KAAK,CAACf,QAAQ,CAACC,KAAT,CAAea,OAAhB,CAAZ;AACA,SAFD,MAEO;AACN,iBAAOC,KAAK,CAACf,QAAQ,CAACC,KAAV,CAAZ;AACA;AACH;;AACD,UAAI+B,gBAAgB,GAAG,EAAvB;AACAhC,MAAAA,QAAQ,CAACiB,IAAT,CAAcX,OAAd,CAAsB,UAACY,GAAD,EAAS;AAC7B,YAAIA,GAAG,CAACe,YAAJ,CAAiBC,KAAjB,CAAuB,GAAvB,EAA4B,CAA5B,KAAkC,EAAtC,EAA0C;AACxCF,UAAAA,gBAAgB,CAACxB,IAAjB,CAAsBU,GAAG,CAACiB,QAA1B;AACD;AACF,OAJD;AAKAxC,MAAAA,SAAS,CAACqC,gBAAD,CAAT;AAED,KAxBH;AA2BA,QAAMI,KAAK,GAAG,EAAd;AACAA,IAAAA,KAAK,CAACjC,QAAN,GAAiB7B,SAAS,CAAC,UAAD,CAA1B;AACA8D,IAAAA,KAAK,CAAChD,UAAN,GAAmBA,UAAnB;AACAgD,IAAAA,KAAK,CAACxB,OAAN,GAAe,KAAf;AACAwB,IAAAA,KAAK,CAACvB,MAAN,GAAe,GAAf;AACA7C,IAAAA,OAAO,CAAC;AACN,kBAAY,wBADN;AAEN,gBAAU,MAFJ;AAGN,cAAQoE;AAHF,KAAD,CAAP,CAIGrC,IAJH,CAKE,UAAAC,QAAQ,EAAI;AAEVf,MAAAA,WAAW,CAAC,KAAD,CAAX;;AAEA,UAAIe,QAAQ,CAACC,KAAb,EAAoB;AACjB,YAAID,QAAQ,CAACC,KAAT,CAAea,OAAnB,EAA4B;AAC3B,iBAAOC,KAAK,CAACf,QAAQ,CAACC,KAAT,CAAea,OAAhB,CAAZ;AACA,SAFD,MAEO;AACN,iBAAOC,KAAK,CAACf,QAAQ,CAACC,KAAV,CAAZ;AACA;AACH;;AACD,UAAIoC,gBAAgB,GAAG,EAAvB;AACArC,MAAAA,QAAQ,CAACiB,IAAT,CAAcqB,KAAd,CAAoBhC,OAApB,CAA4B,UAACY,GAAD,EAAS;AACnC,YAAIA,GAAG,CAACqB,KAAJ,CAAUC,WAAV,GAAwB,EAA5B,EAAgCH,gBAAgB,CAAC7B,IAAjB,CAAsB,YAAtB;AAChC,YAAIU,GAAG,CAACuB,OAAJ,CAAYC,SAAZ,GAAwB,EAA5B,EAAgCL,gBAAgB,CAAC7B,IAAjB,CAAsB,yBAAtB;AAChC,YAAIU,GAAG,CAACuB,OAAJ,CAAYE,KAAZ,GAAoB,EAAxB,EAA4BN,gBAAgB,CAAC7B,IAAjB,CAAsB,qBAAtB;AAC5B,YAAIU,GAAG,CAACuB,OAAJ,CAAYG,WAAZ,GAA0B,EAA9B,EAAkCP,gBAAgB,CAAC7B,IAAjB,CAAsB,sBAAtB;AAClC,YAAIU,GAAG,CAACuB,OAAJ,CAAYI,QAAZ,GAAuB,EAA3B,EAA+BR,gBAAgB,CAAC7B,IAAjB,CAAsB,mBAAtB;AAC/B,YAAIU,GAAG,CAACuB,OAAJ,CAAYK,QAAZ,GAAuB,EAA3B,EAA+BT,gBAAgB,CAAC7B,IAAjB,CAAsB,mBAAtB;AAC/B,YAAIU,GAAG,CAAC6B,YAAJ,CAAiBC,KAAjB,GAAyB,EAA7B,EAAiCX,gBAAgB,CAAC7B,IAAjB,CAAsB,yBAAtB;AAClC,OARD;AASAX,MAAAA,SAAS,CAACwC,gBAAD,CAAT;AAED,KA5BH;AA8BH,GAzIC;;AA2IA,MAAMY,OAAO,GAAG;AAACC,IAAAA,SAAS,EAAE;AAACC,MAAAA,QAAQ,EAAE3E,OAAO,GAAG,CAAH,GAAO;AAAzB;AAAZ,GAAhB;AACA,MAAM4E,WAAW,GAAG,CAApB,CA9LqB,CA8LC;;AAEtB,sBACE;AAAA,2BAEE,QAAC,KAAD;AAAA,8BACE,QAAC,WAAD;AAAA,+BACE,QAAC,IAAD;AAAA,iCACE,QAAC,IAAD;AAAM,YAAA,EAAE,EAAC,GAAT;AAAA,mCACE;AAAI,cAAA,EAAE,EAAC,SAAP;AAAiB,cAAA,SAAS,EAAC,iBAA3B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,eADF,eAaE,QAAC,SAAD;AAAA,+BAEA;AAAK,UAAA,KAAK,EAAE;AAACC,YAAAA,OAAO,EAACD;AAAT,WAAZ;AAAA,qBAEG,sBAAS;AAAK,YAAA,KAAK,EAAE;AAACE,cAAAA,MAAM,EAAE,GAAT;AAAcC,cAAAA,QAAQ,EAAE,UAAxB;AAAoCC,cAAAA,KAAK,EAAE,MAA3C;AAAmDC,cAAAA,MAAM,EAAE,MAA3D;AAAmEC,cAAAA,eAAe,EAAC;AAAnF,aAAZ;AAAA,mCAAwH,QAAC,QAAD;AAAU,cAAA,KAAK,EAAE;AAACH,gBAAAA,QAAQ,EAAE;AAAX;AAAjB;AAAA;AAAA;AAAA;AAAA;AAAxH;AAAA;AAAA;AAAA;AAAA,mBAFZ,eAIE,QAAC,IAAD;AAAA,mCACE,QAAC,IAAD;AAAM,cAAA,EAAE,EAAC,IAAT;AAAc,cAAA,EAAE,EAAC,GAAjB;AAAA,qCACE,QAAC,KAAD;AACE,gBAAA,KAAK,EAAE,QADT;AAEE,gBAAA,SAAS,EAAE,OAFb;AAAA,wCAIE,QAAC,WAAD;AAAA,yCACE,QAAC,IAAD;AAAA,2CACE,QAAC,IAAD;AAAA,6CACE;AAAI,wBAAA,EAAE,EAAC,SAAP;AAAiB,wBAAA,SAAS,EAAC,iBAA3B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,yBAJF,eAaE,QAAC,SAAD;AAAA,yCAEE,QAAC,SAAD;AAAA,+BACI7E,QAAQ,gBACT;AAAK,sBAAA,SAAS,EAAC,aAAf;AAAA,6CACC,QAAC,QAAD;AACE,wBAAA,SAAS,EAAC,iBADZ;AAEE,wBAAA,KAAK,EAAC;AAFR;AAAA;AAAA;AAAA;AAAA;AADD;AAAA;AAAA;AAAA;AAAA,6BADS,gBAQR;AAAG,sBAAA,KAAK,EAAC,EAAT;AAAA,uGACE;AAAA,kCAAKY,MAAM,CAACqE,MAAP,GAAgB,CAAhB,GAAoBrE,MAAM,CAACsE,IAAP,CAAY,KAAZ,CAApB,GAAyC;AAA9C;AAAA;AAAA;AAAA;AAAA,+BADF;AAAA;AAAA;AAAA;AAAA;AAAA,6BATJ,eAaE;AAAG,sBAAA,KAAK,EAAC,EAAT;AAAA,8HACE;AAAA,kCAAKpE,MAAM,CAACmE,MAAP,GAAgB,CAAhB,GAAoBnE,MAAM,CAACoE,IAAP,CAAY,KAAZ,CAApB,GAAyC;AAA9C;AAAA;AAAA;AAAA;AAAA,+BADF;AAAA;AAAA;AAAA;AAAA;AAAA,6BAbF,eAgBE;AAAG,sBAAA,KAAK,EAAC,EAAT;AAAA,4FACE;AAAA,kCAAKlE,MAAM,CAACiE,MAAP,GAAgB,CAAhB,GAAoBjE,MAAM,CAACkE,IAAP,CAAY,KAAZ,CAApB,GAAyC;AAA9C;AAAA;AAAA;AAAA;AAAA,+BADF;AAAA;AAAA;AAAA;AAAA;AAAA,6BAhBF,eAmBE;AAAG,sBAAA,KAAK,EAAC,EAAT;AAAA,mFACE;AAAA,kCAAKhE,MAAM,CAAC+D,MAAP,GAAgB,CAAhB,GAAoB/D,MAAM,CAACiE,GAAP,CAAW,UAAAC,CAAC;AAAA,8CAAE,QAAC,KAAD,CAAO,QAAP;AAAA,uCAAiBA,CAAjB,eAAmB;AAAA;AAAA;AAAA;AAAA,qCAAnB;AAAA;AAAA;AAAA;AAAA;AAAA,mCAAF;AAAA,yBAAZ,CAApB,GAA+E;AAApF;AAAA;AAAA;AAAA;AAAA,+BADF;AAAA;AAAA;AAAA;AAAA;AAAA,6BAnBF;AAAA;AAAA;AAAA;AAAA;AAAA;AAFF;AAAA;AAAA;AAAA;AAAA,yBAbF;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,mBAJF;AAAA;AAAA;AAAA;AAAA;AAAA;AAFA;AAAA;AAAA;AAAA;AAAA,eAbF;AAAA;AAAA;AAAA;AAAA;AAAA;AAFF,mBADF;AA6ED,CA7QD;;GAAMvF,Q;;KAAAA,Q;AA+QN,eAAeA,QAAf","sourcesContent":["import React, { lazy, useEffect, useState } from 'react'\r\n\r\nimport {\r\n  CCard,\r\n  CCardBody,\r\n  CCardHeader,\r\n  CCol,\r\n  CRow,\r\n  CSpinner,\r\n  CWidgetDropdown,\r\n  CCardTitle,\r\n  CCardText\r\n} from '@coreui/react'\r\n\r\nimport CIcon from '@coreui/icons-react'\r\n\r\nimport DataAPI from '../../../../helpers/DataAPI.js'\r\nimport {DateFilter, round, getDateLabel, getCurrentDateNDaysBefore} from '../../../../helpers/utils.js'\r\nimport {setCookie,getCookie} from '../../../../helpers/sessionCookie.js'\r\n\r\nconst Overview = () => {\r\n\r\n  const [loading, setLoading] = useState(false);\r\n  const [loading1, setLoading1] = useState(true);\r\n  const [loading2, setLoading2] = useState(false);\r\n  const [loading3, setLoading3] = useState(false);\r\n  const [loading4, setLoading4] = useState(false);\r\n  const [dataLoaded, setDataLoaded] = useState(false);\r\n  const [generators, setGenerators] = useState([]);\r\n\r\n  const [alert1, setAlert1] = useState([]);\r\n  const [alert2, setAlert2] = useState([]);\r\n  const [alert3, setAlert3] = useState([]);\r\n  const [alert4, setAlert4] = useState([]);\r\n\r\n\r\n  useEffect(() => {\r\n    loadGenerators();\r\n  }, []);\r\n\r\n\r\n  const loadGenerators = () => {\r\n\r\n    DataAPI({\r\n      'endpoint': 'admin/locations/current',\r\n      'method': 'GET'\r\n    }).then(\r\n      response => {\r\n        \r\n        if (response && response.error) {\r\n          setCookie('lastTimeStamp', '');\r\n          setCookie('name', '');\r\n          window.location.reload();\r\n        }\r\n        else if (!dataLoaded && response  && !response.error) {\r\n          let gen = [];\r\n          if (response.generators != null) {\r\n            response.generators.forEach(\r\n              generator => { \r\n                gen.push(generator.id)\r\n              })\r\n            setGenerators(gen);\r\n          }\r\n          fetchAlerts();\r\n        }\r\n      }\r\n    );\r\n  }\r\n\r\n\r\n  const fetchAlerts = () => {\r\n  \r\n    const body = {}\r\n    body.location = getCookie('location')\r\n    body.groupBy =\"day\"\r\n    body.period = \"cm\"\r\n    DataAPI({\r\n      'endpoint': 'chart/performanceIndex',\r\n      'method': 'POST',\r\n      'body': body\r\n    }).then(\r\n      response => {\r\n\r\n        setLoading1(false);\r\n\r\n        if (response.error) {\r\n           if (response.error.message) {\r\n            return(alert(response.error.message))\r\n           } else {\r\n            return(alert(response.error)) \r\n           }\r\n        }\r\n\r\n        let generatorsAlert1 = []\r\n        response.data.forEach((rDs) => {\r\n          if (rDs.name!='Total') {\r\n            if (rDs.data.performance.performanceIndex < 90) {\r\n              generatorsAlert1.push(rDs.code)\r\n            }\r\n          }\r\n        });\r\n        setAlert1(generatorsAlert1)\r\n      }\r\n    );\r\n\r\n    const body2 = {}\r\n    body2.location = getCookie('location')\r\n    body2.groupBy =\"day\"\r\n    body2.from = getCurrentDateNDaysBefore(\"-\",2)\r\n    body2.to = getCurrentDateNDaysBefore(\"-\",1)\r\n    DataAPI({\r\n      'endpoint': 'chart/performanceIndex',\r\n      'method': 'POST',\r\n      'body': body2\r\n    }).then(\r\n      response => {\r\n\r\n        setLoading2(false);\r\n\r\n        if (response.error) {\r\n           if (response.error.message) {\r\n            return(alert(response.error.message))\r\n           } else {\r\n            return(alert(response.error)) \r\n           }\r\n        }\r\n\r\n        let generatorsAlert2 = []\r\n        response.data.forEach((rDs) => {\r\n          if (rDs.name!='Total') {\r\n            const pIYesterday = rDs.data.graph[0].value\r\n            const pIBeforeYesterday = rDs.data.graph[1].value\r\n            if (pIBeforeYesterday - pIYesterday > 6) {\r\n              generatorsAlert2.push(rDs.code)\r\n            }\r\n          }\r\n        });\r\n        setAlert2(generatorsAlert2)\r\n      }\r\n    );\r\n\r\n    const body3 = {}\r\n    body3.location = getCookie('location')\r\n    body3.generators = generators\r\n    body3.period = \"y\"\r\n    DataAPI({\r\n      'endpoint': 'chart/stopped',\r\n      'method': 'POST',\r\n      'body': body3\r\n    }).then(\r\n      response => {\r\n\r\n        setLoading3(false);\r\n\r\n        if (response.error) {\r\n           if (response.error.message) {\r\n            return(alert(response.error.message))\r\n           } else {\r\n            return(alert(response.error)) \r\n           }\r\n        }\r\n        let generatorsAlert3 = []\r\n        response.data.forEach((rDs) => {\r\n          if (rDs.missingHours.split(\":\")[0] >= 10) {\r\n            generatorsAlert3.push(rDs.gen_code)\r\n          }\r\n        });\r\n        setAlert3(generatorsAlert3)   \r\n        \r\n      }\r\n    );\r\n\r\n    const body4 = {}\r\n    body4.location = getCookie('location')\r\n    body4.generators = generators\r\n    body4.groupBy =\"day\"\r\n    body4.period = \"y\"\r\n    DataAPI({\r\n      'endpoint': 'chart/dataAvailability',\r\n      'method': 'POST',\r\n      'body': body4\r\n    }).then(\r\n      response => {\r\n\r\n        setLoading4(false);\r\n\r\n        if (response.error) {\r\n           if (response.error.message) {\r\n            return(alert(response.error.message))\r\n           } else {\r\n            return(alert(response.error)) \r\n           }\r\n        }\r\n        let generatorsAlert4 = []\r\n        response.data.table.forEach((rDs) => {\r\n          if (rDs.total.turbineData < 90) generatorsAlert4.push(\"Turbine XX\");\r\n          if (rDs.metMast.direction < 90) generatorsAlert4.push(\"Met Mast Wind Direction\");\r\n          if (rDs.metMast.speed < 90) generatorsAlert4.push(\"Met Mast Wind Speed\");\r\n          if (rDs.metMast.temperature < 90) generatorsAlert4.push(\"Met Mast Temperature\");\r\n          if (rDs.metMast.pressure < 90) generatorsAlert4.push(\"Met Mast Pressure\");\r\n          if (rDs.metMast.humidity < 90) generatorsAlert4.push(\"Met Mast Humidity\");\r\n          if (rDs.turbineState.state < 90) generatorsAlert4.push(\"Grid Curtailment Status\");\r\n        });\r\n        setAlert4(generatorsAlert4)   \r\n        \r\n      }\r\n    );\r\n}\r\n\r\n  const options = {animation: {duration: loading ? 0 : 1000}};\r\n  const bodyOpacity = 1;//loading?.5:1\r\n\r\n  return (\r\n    <>\r\n      \r\n      <CCard>\r\n        <CCardHeader>\r\n          <CRow>\r\n            <CCol sm=\"9\">\r\n              <h3 id=\"traffic\" className=\"card-title mb-0\">\r\n                Alerts\r\n              </h3>\r\n              {/* <div className=\"small text-medium-emphasis\">{getDateLabel(dateRange)}</div> */}\r\n            </CCol>\r\n          </CRow>\r\n\r\n\r\n        </CCardHeader>\r\n        <CCardBody>\r\n\r\n        <div style={{opacity:bodyOpacity}}>\r\n\r\n          {false && <div style={{zIndex: 999, position: 'absolute', width: '100%', height: '100%', backgroundColor:'rgba(255,255,255,.7)'}}><CSpinner style={{position: 'absolute'}} /></div>}\r\n          \r\n          <CRow>\r\n            <CCol sm=\"12\" lg=\"6\">\r\n              <CCard\r\n                color={\"danger\"}\r\n                textColor={\"white\"}\r\n              >\r\n                <CCardHeader>\r\n                  <CRow>\r\n                    <CCol>\r\n                      <h4 id=\"traffic\" className=\"card-title mb-0\">\r\n                        ALERTS\r\n                      </h4>\r\n                    </CCol>\r\n                  </CRow>\r\n                </CCardHeader>\r\n                <CCardBody>\r\n                  {/* <CCardTitle>ALERTS</CCardTitle> */}\r\n                  <CCardText>\r\n                    { loading1 ? \r\n                     <div className='text-center'>\r\n                      <CSpinner \r\n                        className=\"loading-spinner\"\r\n                        color='#321fdb'\r\n                      />\r\n                    </div>\r\n                    :\r\n                      <p class=\"\">Wind turbines with performance &lt; 90% (current month): \r\n                        <h3>{alert1.length > 0 ? alert1.join(' - ') : \" - \"}</h3>\r\n                      </p>\r\n                    }\r\n                    <p class=\"\">Wind turbines with negative change exceeding -6% in performance (yesterday): \r\n                      <h3>{alert2.length > 0 ? alert2.join(' - ') : \" - \"}</h3>\r\n                    </p>\r\n                    <p class=\"\">Wind turbines with long stops (yesterday): \r\n                      <h3>{alert3.length > 0 ? alert3.join(' - ') : \" - \"}</h3>\r\n                    </p>\r\n                    <p class=\"\">&lt; 90% data available (yesterday): \r\n                      <h4>{alert4.length > 0 ? alert4.map(s=><React.Fragment>{s}<br/></React.Fragment>) : \" - \"}</h4>\r\n                    </p>\r\n                  </CCardText>\r\n                </CCardBody>\r\n              </CCard>\r\n\r\n\r\n            </CCol>\r\n          </CRow>\r\n\r\n        </div>\r\n        \r\n        </CCardBody>\r\n\r\n        </CCard>\r\n\r\n    </>\r\n  )\r\n}\r\n\r\nexport default Overview\r\n"]},"metadata":{},"sourceType":"module"}
{"ast":null,"code":"import _slicedToArray from \"C:/Users/nicob/Desktop/Renovus/renovus/falconer_ui_web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\nicob\\\\Desktop\\\\Renovus\\\\renovus\\\\falconer_ui_web\\\\src\\\\views\\\\pages\\\\overview\\\\alerts.js\",\n    _this = this,\n    _s = $RefreshSig$();\n\nimport React, { lazy, useEffect, useState } from 'react';\nimport { CCard, CCardBody, CCardHeader, CCol, CRow, CSpinner, CWidgetDropdown, CCardTitle, CCardText } from '@coreui/react';\nimport CIcon from '@coreui/icons-react';\nimport DataAPI from '../../../helpers/DataAPI.js';\nimport { DateFilter, round, getDateLabel, getCurrentDateNDaysBefore } from '../../../helpers/utils.js';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nvar Overview = function Overview() {\n  _s();\n\n  var _useState = useState(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      loading = _useState2[0],\n      setLoading = _useState2[1];\n\n  var _useState3 = useState(false),\n      _useState4 = _slicedToArray(_useState3, 2),\n      dataLoaded = _useState4[0],\n      setDataLoaded = _useState4[1];\n\n  var _useState5 = useState([]),\n      _useState6 = _slicedToArray(_useState5, 2),\n      generators = _useState6[0],\n      setGenerators = _useState6[1];\n\n  var _useState7 = useState([]),\n      _useState8 = _slicedToArray(_useState7, 2),\n      alert1 = _useState8[0],\n      setAlert1 = _useState8[1];\n\n  var _useState9 = useState([]),\n      _useState10 = _slicedToArray(_useState9, 2),\n      alert2 = _useState10[0],\n      setAlert2 = _useState10[1];\n\n  var _useState11 = useState([]),\n      _useState12 = _slicedToArray(_useState11, 2),\n      alert3 = _useState12[0],\n      setAlert3 = _useState12[1];\n\n  useEffect(function () {\n    loadGenerators();\n    refreshChart(dateRange);\n  }, []);\n\n  var loadGenerators = function loadGenerators() {\n    DataAPI({\n      'endpoint': 'admin/locations/current',\n      'method': 'GET'\n    }).then(function (response) {\n      if (!dataLoaded && response && !response.error) {\n        var gen = [];\n        response.generators.forEach(function (generator) {\n          gen.push(generator.id);\n        });\n        setGenerators(gen);\n        fetchAlerts();\n      }\n    });\n  };\n\n  var fetchAlerts = function fetchAlerts() {\n    DataAPI({\n      'endpoint': 'chart/performanceIndex',\n      'method': 'POST',\n      'body': {\n        period: \"cm\",\n        groupBy: \"day\"\n      }\n    }).then(function (response) {\n      if (response.error) {\n        if (response.error.message) {\n          return alert(response.error.message);\n        } else {\n          return alert(response.error);\n        }\n      }\n\n      var generatorsAlert1 = [];\n      response.data.forEach(function (rDs) {\n        if (rDs.name != 'Total') {\n          if (rDs.data.performance.performanceIndex < 90) {\n            generatorsAlert1.push(rDs.name);\n          }\n        }\n      });\n      setAlert1(generatorsAlert1);\n    });\n    DataAPI({\n      'endpoint': 'chart/performanceIndex',\n      'method': 'POST',\n      'body': {\n        from: getCurrentDateNDaysBefore(\"-\", 2),\n        to: getCurrentDateNDaysBefore(\"-\", 1),\n        groupBy: \"day\"\n      }\n    }).then(function (response) {\n      if (response.error) {\n        if (response.error.message) {\n          return alert(response.error.message);\n        } else {\n          return alert(response.error);\n        }\n      }\n\n      var generatorsAlert2 = [];\n      response.data.forEach(function (rDs) {\n        if (rDs.name != 'Total') {\n          var pIYesterday = rDs.data.graph[0].value;\n          var pIBeforeYesterday = rDs.data.graph[1].value;\n\n          if (pIBeforeYesterday - pIYesterday > 6) {\n            generatorsAlert2.push(rDs.name);\n          }\n        }\n      });\n      setAlert2(generatorsAlert2);\n    });\n    DataAPI({\n      'endpoint': 'chart/stopped',\n      'method': 'POST',\n      'body': {\n        period: \"y\",\n        generators: generators\n      }\n    }).then(function (response) {\n      if (response.error) {\n        if (response.error.message) {\n          return alert(response.error.message);\n        } else {\n          return alert(response.error);\n        }\n      }\n\n      var generatorsAlert3 = [];\n      response.data.forEach(function (rDs) {\n        if (rDs.missingHours.split(\":\")[0] >= 10) {\n          generatorsAlert3.push(rDs.gen_code);\n        }\n      });\n      setAlert3(generatorsAlert3);\n    });\n  };\n\n  var options = {\n    animation: {\n      duration: loading ? 0 : 1000\n    }\n  };\n  var bodyOpacity = 1; //loading?.5:1\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: /*#__PURE__*/_jsxDEV(CCard, {\n      children: [/*#__PURE__*/_jsxDEV(CCardHeader, {\n        children: /*#__PURE__*/_jsxDEV(CRow, {\n          children: /*#__PURE__*/_jsxDEV(CCol, {\n            sm: \"9\",\n            children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n              id: \"traffic\",\n              className: \"card-title mb-0\",\n              children: \"Alerts\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 154,\n              columnNumber: 15\n            }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"small text-medium-emphasis\",\n              children: getDateLabel(dateRange)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 157,\n              columnNumber: 15\n            }, _this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 153,\n            columnNumber: 13\n          }, _this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 152,\n          columnNumber: 11\n        }, _this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 151,\n        columnNumber: 9\n      }, _this), /*#__PURE__*/_jsxDEV(CCardBody, {\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            opacity: bodyOpacity\n          },\n          children: [false && /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              zIndex: 999,\n              position: 'absolute',\n              width: '100%',\n              height: '100%',\n              backgroundColor: 'rgba(255,255,255,.7)'\n            },\n            children: /*#__PURE__*/_jsxDEV(CSpinner, {\n              style: {\n                position: 'absolute'\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 167,\n              columnNumber: 141\n            }, _this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 167,\n            columnNumber: 21\n          }, _this), /*#__PURE__*/_jsxDEV(CRow, {\n            children: /*#__PURE__*/_jsxDEV(CCol, {\n              sm: \"6\",\n              lg: \"4\",\n              children: /*#__PURE__*/_jsxDEV(CCard, {\n                color: \"danger\",\n                textColor: \"white\",\n                children: /*#__PURE__*/_jsxDEV(CCardBody, {\n                  children: [/*#__PURE__*/_jsxDEV(CCardTitle, {\n                    children: \"ALERTS\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 177,\n                    columnNumber: 19\n                  }, _this), /*#__PURE__*/_jsxDEV(CCardText, {\n                    children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                      class: \"\",\n                      children: [\"Wind turbines with performance < 90% (current month):\", /*#__PURE__*/_jsxDEV(\"h5\", {\n                        children: alert1.length > 0 ? alert1.join(' - ') : \" - \"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 180,\n                        columnNumber: 23\n                      }, _this)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 179,\n                      columnNumber: 21\n                    }, _this), /*#__PURE__*/_jsxDEV(\"p\", {\n                      class: \"\",\n                      children: [\"Wind turbines with negative change exceeding -6% in performance (yesterday):\", /*#__PURE__*/_jsxDEV(\"h5\", {\n                        children: alert2.length > 0 ? alert2.join(' - ') : \" - \"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 183,\n                        columnNumber: 23\n                      }, _this)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 182,\n                      columnNumber: 21\n                    }, _this), /*#__PURE__*/_jsxDEV(\"p\", {\n                      class: \"\",\n                      children: [\"Wind turbines with long stops (yesterday):\", /*#__PURE__*/_jsxDEV(\"h5\", {\n                        children: alert3.length > 0 ? alert3.join(' - ') : \" - \"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 186,\n                        columnNumber: 23\n                      }, _this)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 185,\n                      columnNumber: 21\n                    }, _this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 178,\n                    columnNumber: 19\n                  }, _this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 176,\n                  columnNumber: 17\n                }, _this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 171,\n                columnNumber: 15\n              }, _this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 170,\n              columnNumber: 13\n            }, _this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 169,\n            columnNumber: 11\n          }, _this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 165,\n          columnNumber: 9\n        }, _this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 163,\n        columnNumber: 9\n      }, _this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 7\n    }, _this)\n  }, void 0, false);\n};\n\n_s(Overview, \"yg+wqQi5aw15Rn91eoCKc2c7y70=\");\n\n_c = Overview;\nexport default Overview;\n\nvar _c;\n\n$RefreshReg$(_c, \"Overview\");","map":{"version":3,"sources":["C:/Users/nicob/Desktop/Renovus/renovus/falconer_ui_web/src/views/pages/overview/alerts.js"],"names":["React","lazy","useEffect","useState","CCard","CCardBody","CCardHeader","CCol","CRow","CSpinner","CWidgetDropdown","CCardTitle","CCardText","CIcon","DataAPI","DateFilter","round","getDateLabel","getCurrentDateNDaysBefore","Overview","loading","setLoading","dataLoaded","setDataLoaded","generators","setGenerators","alert1","setAlert1","alert2","setAlert2","alert3","setAlert3","loadGenerators","refreshChart","dateRange","then","response","error","gen","forEach","generator","push","id","fetchAlerts","period","groupBy","message","alert","generatorsAlert1","data","rDs","name","performance","performanceIndex","from","to","generatorsAlert2","pIYesterday","graph","value","pIBeforeYesterday","generatorsAlert3","missingHours","split","gen_code","options","animation","duration","bodyOpacity","opacity","zIndex","position","width","height","backgroundColor","length","join"],"mappings":"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","sourcesContent":["import React, { lazy, useEffect, useState } from 'react'\r\n\r\nimport {\r\n  CCard,\r\n  CCardBody,\r\n  CCardHeader,\r\n  CCol,\r\n  CRow,\r\n  CSpinner,\r\n  CWidgetDropdown,\r\n  CCardTitle,\r\n  CCardText\r\n} from '@coreui/react'\r\n\r\nimport CIcon from '@coreui/icons-react'\r\n\r\nimport DataAPI from '../../../helpers/DataAPI.js'\r\nimport {DateFilter, round, getDateLabel, getCurrentDateNDaysBefore} from '../../../helpers/utils.js'\r\n\r\nconst Overview = () => {\r\n\r\n  const [loading, setLoading] = useState(false);\r\n  const [dataLoaded, setDataLoaded] = useState(false);\r\n  const [generators, setGenerators] = useState([]);\r\n\r\n  const [alert1, setAlert1] = useState([]);\r\n  const [alert2, setAlert2] = useState([]);\r\n  const [alert3, setAlert3] = useState([]);\r\n\r\n\r\n  useEffect(() => {\r\n    loadGenerators();\r\n    refreshChart(dateRange);\r\n  }, []);\r\n\r\n\r\n  const loadGenerators = () => {\r\n\r\n    DataAPI({\r\n      'endpoint': 'admin/locations/current',\r\n      'method': 'GET'\r\n    }).then(\r\n      response => {\r\n        \r\n        if (!dataLoaded && response  && !response.error) {\r\n          let gen = [];\r\n          response.generators.forEach(\r\n            generator => { \r\n              gen.push(generator.id)\r\n            })\r\n          setGenerators(gen);\r\n          fetchAlerts();\r\n        }\r\n      }\r\n    );\r\n  }\r\n\r\n\r\n  const fetchAlerts = () => {\r\n  \r\n    DataAPI({\r\n      'endpoint': 'chart/performanceIndex',\r\n      'method': 'POST',\r\n      'body': {period: \"cm\", groupBy:\"day\"}\r\n    }).then(\r\n      response => {\r\n\r\n        if (response.error) {\r\n           if (response.error.message) {\r\n            return(alert(response.error.message))\r\n           } else {\r\n            return(alert(response.error)) \r\n           }\r\n        }\r\n\r\n        let generatorsAlert1 = []\r\n        response.data.forEach((rDs) => {\r\n          if (rDs.name!='Total') {\r\n            if (rDs.data.performance.performanceIndex < 90) {\r\n              generatorsAlert1.push(rDs.name)\r\n            }\r\n          }\r\n        });\r\n        setAlert1(generatorsAlert1)\r\n      }\r\n    );\r\n\r\n    DataAPI({\r\n      'endpoint': 'chart/performanceIndex',\r\n      'method': 'POST',\r\n      'body': {from: getCurrentDateNDaysBefore(\"-\",2), to: getCurrentDateNDaysBefore(\"-\",1), groupBy:\"day\"}\r\n    }).then(\r\n      response => {\r\n\r\n        if (response.error) {\r\n           if (response.error.message) {\r\n            return(alert(response.error.message))\r\n           } else {\r\n            return(alert(response.error)) \r\n           }\r\n        }\r\n\r\n        let generatorsAlert2 = []\r\n        response.data.forEach((rDs) => {\r\n          if (rDs.name!='Total') {\r\n            const pIYesterday = rDs.data.graph[0].value\r\n            const pIBeforeYesterday = rDs.data.graph[1].value\r\n            if (pIBeforeYesterday - pIYesterday > 6) {\r\n              generatorsAlert2.push(rDs.name)\r\n            }\r\n          }\r\n        });\r\n        setAlert2(generatorsAlert2)\r\n      }\r\n    );\r\n\r\n\r\n    DataAPI({\r\n      'endpoint': 'chart/stopped',\r\n      'method': 'POST',\r\n      'body': {period:\"y\",generators:generators}\r\n    }).then(\r\n      response => {\r\n\r\n        if (response.error) {\r\n           if (response.error.message) {\r\n            return(alert(response.error.message))\r\n           } else {\r\n            return(alert(response.error)) \r\n           }\r\n        }\r\n        let generatorsAlert3 = []\r\n        response.data.forEach((rDs) => {\r\n          if (rDs.missingHours.split(\":\")[0] >= 10) {\r\n            generatorsAlert3.push(rDs.gen_code)\r\n          }\r\n        });\r\n        setAlert3(generatorsAlert3)   \r\n        \r\n      }\r\n    );\r\n}\r\n\r\n  const options = {animation: {duration: loading ? 0 : 1000}};\r\n  const bodyOpacity = 1;//loading?.5:1\r\n\r\n  return (\r\n    <>\r\n      \r\n      <CCard>\r\n        <CCardHeader>\r\n          <CRow>\r\n            <CCol sm=\"9\">\r\n              <h3 id=\"traffic\" className=\"card-title mb-0\">\r\n                Alerts\r\n              </h3>\r\n              <div className=\"small text-medium-emphasis\">{getDateLabel(dateRange)}</div>\r\n            </CCol>\r\n          </CRow>\r\n\r\n\r\n        </CCardHeader>\r\n        <CCardBody>\r\n\r\n        <div style={{opacity:bodyOpacity}}>\r\n\r\n          {false && <div style={{zIndex: 999, position: 'absolute', width: '100%', height: '100%', backgroundColor:'rgba(255,255,255,.7)'}}><CSpinner style={{position: 'absolute'}} /></div>}\r\n          \r\n          <CRow>\r\n            <CCol sm=\"6\" lg=\"4\">\r\n              <CCard\r\n                color={\"danger\"}\r\n                textColor={\"white\"}\r\n              >\r\n\r\n                <CCardBody>\r\n                  <CCardTitle>ALERTS</CCardTitle>\r\n                  <CCardText>\r\n                    <p class=\"\">Wind turbines with performance &lt; 90% (current month): \r\n                      <h5>{alert1.length > 0 ? alert1.join(' - ') : \" - \"}</h5>\r\n                    </p>\r\n                    <p class=\"\">Wind turbines with negative change exceeding -6% in performance (yesterday): \r\n                      <h5>{alert2.length > 0 ? alert2.join(' - ') : \" - \"}</h5>\r\n                    </p>\r\n                    <p class=\"\">Wind turbines with long stops (yesterday): \r\n                      <h5>{alert3.length > 0 ? alert3.join(' - ') : \" - \"}</h5>\r\n                    </p>\r\n                  </CCardText>\r\n                </CCardBody>\r\n              </CCard>\r\n\r\n\r\n            </CCol>\r\n          </CRow>\r\n\r\n        </div>\r\n        \r\n        </CCardBody>\r\n\r\n        </CCard>\r\n\r\n    </>\r\n  )\r\n}\r\n\r\nexport default Overview\r\n"]},"metadata":{},"sourceType":"module"}